name: pr-gate

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

permissions:
  contents: read
  pull-requests: read

jobs:
  pr_gate_issue_link:
    runs-on: ubuntu-latest
    steps:
      - name: Enforce linked issue keyword
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const text = `${pr.title || ''}\n${pr.body || ''}`;
            const re = /(?:close[sd]?|fix(?:e[sd])?|resolve[sd]?)\s+(?:[A-Za-z0-9_.-]+\/[A-Za-z0-9_.-]+)?#\d+/i;
            if (!re.test(text)) {
              core.setFailed('PR must include linked issue keyword, e.g. "Closes #123" or "Fixes owner/repo#123".');
            } else {
              core.info('Issue link keyword detected.');
            }
